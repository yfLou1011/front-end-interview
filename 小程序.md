
## 小程序和h5的区别
- 运行环境
  - h5是运行在浏览器的，包括App的webview和小程序提供的webview
  - 小程序是基于浏览器内核重构的内置解析器
  - 小程序在脚本内无法使用浏览器中常用的 window 对象和 document 对象 => 没有DOM
- 运行机制
  - 小程序的冷启动(第一次加载/主动销毁)和热启动(切换前后台)
- 开发语言
  - h5: JS / CSS3 / HTML5
  - 不同的小程序都有自己定义独特的语言；微信小程序，自定义的 WXML、WXSS，WXS
- 更新机制
  - h5随时
  - 小程序 需要审核

## 小程序的渲染逻辑
- 双线模型; 小程序的渲染层(WebView线程)和逻辑层(JSCore线程)分别由2个线程管理
- 在渲染层将 WXML 先转换为 js 对象也就是虚拟 DOM
- 在逻辑层将虚拟 DOM 对象生成真实 DOM 树，交给渲染层渲染
- 当视图有数据需更新时，逻辑层调用小程序宿主环境提供的 **setData** 方法将数据从逻辑层传递到渲染层
- 经过对比前后差异 ( diff算法 )，把差异应用在真实的 Dom 树上，渲染出正确的 UI 界面完成视图更新

## 小程序性能优化   
- https://developers.weixin.qq.com/community/develop/article/doc/00008edebb42f853622814fb356c13
- 启动加载性能(下载代码、加载代码、初始化首页)
  - 控制包大小
    1. 勾选开发者工具中“上传代码时，压缩代码”选项
    2. 及时清理无用文件
    3. 减少资源包中的图片等资源的数量和大小
  - 分包加载机制
  - 分包预加载技术(子包预加载技术)
  - 首次渲染的时间开销大体上与节点树中节点的总量成正比例关系，因此
  - 利用缓存
  - 使用骨架屏占位，防止白屏
- 渲染性能优化
  - setData
    - 避免频繁调用setData(每次都是进程间的通信，消耗资源)
    - 避免setData的数据量过大(使用特殊key实现局部更新)
    
## 小程序的生命周期(App生命周期 & Page生命周期)
- App生命周期主要在app.js中调用，主要是：
    1. onLaunch -- 小程序初始化完成，全局只触发一次
    2. onShow -- 小程序启动时，或者从后台进入前台
    3. onHide -- 小程序从前台进入后台时执行
    4. onError -- 小程序运行脚本出错或者api调用失败时执行，会带上错误信息
    5. onPageNotFound -- 小程序页面不存在时执行
    - 执行顺序: onLaunch--> onShow --> onHide

- Pages生命周期主要是指各个文件对应的js中的生命周期，主要是：
    1. onLoad -- 页面加载时执行，只执行一次
    2. onReady -- 页面初次渲染时执行，只执行一次
    3. onShow -- 页面展示时执行，执行多次 (当切换页面需要多次渲染数据改变状态，建议在onShow中使用)
    4. onHide -- 页面从前台进入后台时执行
    5. onUnload -- 页面卸载时执行
